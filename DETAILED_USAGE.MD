## Team Workflow
Here's how our team uses this stack and deploys it using Terraform. We also use OCI Object Storage to upload the playbook 
that we bundle and pull it down during bootstrapping in Terraform. Following are the steps used by our bootstrapping script 
to deploy this stack.

To run this playbook manually, this repository needs to first be bundled up with the dependencies and roles and uploaded to an 
object storage bucket as a `tgz` file.

Note: The instructions below use variables. Please check you've set all the required variables or that you've replaced them 
with your values.

Assuming you have cloned the repository and are in the repository root:

Command to install the Ansible roles
```
ansible-galaxy install -r requirements.yml -p ./.galaxy-roles
```

Command to bundle up the playbook. Here the `playbook_zip` variable is `target_dir/playbook_name`
```
tar -czf $playbook_zip $playbook_name
```

Command to upload the tar file to object storage
```
oci os object put -ns $namespace -bn $bucketname --file $playbook_zip --name ${playbook_name}.tgz
```

After terraform provisions the instances, the bootstrapping script pulls the appropriate tar file from object store and 
runs the playbook using the following command:

```
oci os object get -bn ${bootstrap_bucket} --file $PACKAGE_CACHE/${bootstrap_bundle} --name ${bootstrap_bundle}
```

Because we are not using ansible inventory to run the playbooks, the bootstrapping script runs the following command to 
launch the playbook directly on each of the hosts locally.

```
ansible-playbook -i localhost, $OCI_RSA_BASE/${playbook_name}/main.yml --connection=local
```

An `extra_variables.yml` file is required to set the variables below. These values are randomly generated by terraform 
and sent to the instances during bootstrapping. Here the Wazuh password, Open Distro Elasticsearch security password, Wazuh
bucket name, and the node type can be overridden by the user. 

Note: It is highly recommended that you replace these insecure default passwords with your own values. 
```
wazuh_api_users:
  - username: "wazuh"
    password: "${}"
elasticsearch_security_password: "${}"
wazuh_backup_bucket_name: "${}"
wazuh_node_type: "${}"
```
